language: java
jdk:
  - oraclejdk8

# Don't use the Travis Container-Based Infrastructure (jobs are killed during execution)
sudo: true
dist: trusty

before_install:
  # Coverity token
  - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
   
  # Install zookeeper
  - mkdir /tmp/zookeeper
  - export ZK="apache-zookeeper-3.7.0-bin"
  - wget https://archive.apache.org/dist/zookeeper/zookeeper-3.7.0/$ZK.tar.gz
  - tar xzf $ZK.tar.gz -C /tmp/zookeeper
  - cp /tmp/zookeeper/$ZK/conf/zoo_sample.cfg /tmp/zookeeper/$ZK/conf/zoo.cfg
  - /tmp/zookeeper/$ZK/bin/zkServer.sh start
  - cat /tmp/zookeeper/$ZK/logs/*

  # Change config
  - sed -i "s/zookeepernodes:.*/zookeepernodes:\ ['localhost:2181']/" conf/bboxdb.yaml
  - echo "#####################################################################"
  - cat conf/bboxdb.yaml
  - echo "#####################################################################"
  # Create required directories
  - mkdir -p /tmp/bboxdb/data

after_success:
  - bash <(curl -s https://codecov.io/bash)
  
cache:
  directories:
  - $HOME/.m2
  

